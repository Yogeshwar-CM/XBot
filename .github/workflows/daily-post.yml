name: Daily X Post

on:
  schedule:
    # Run at 9:00 AM IST (03:30 UTC) every day
    - cron: '30 3 * * *'
    # Run at 7:34 PM IST (14:04 UTC) every day
    - cron: '4 14 * * *'
  workflow_dispatch:  # Allow manual trigger

jobs:
  post:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'
      
      - name: Install dependencies
        run: pip install -r requirements.txt
      
      - name: Restore cache
        uses: actions/cache@v4
        with:
          path: cache/
          key: xbot-cache-${{ github.run_id }}
          restore-keys: |
            xbot-cache-
      
      - name: Run X Automation Bot
        env:
          X_API_KEY: ${{ secrets.X_API_KEY }}
          X_API_SECRET: ${{ secrets.X_API_SECRET }}
          X_ACCESS_TOKEN: ${{ secrets.X_ACCESS_TOKEN }}
          X_ACCESS_TOKEN_SECRET: ${{ secrets.X_ACCESS_TOKEN_SECRET }}
          GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
          DRY_RUN: 'false'
          TIMEZONE: 'Asia/Kolkata'
        run: python main.py --now
      
      - name: Save cache
        if: always()
        uses: actions/cache/save@v4
        with:
          path: cache/
          key: xbot-cache-${{ github.run_id }}
      
      - name: Upload log artifact
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: bot-log-${{ github.run_number }}
          path: bot.log
          retention-days: 7
